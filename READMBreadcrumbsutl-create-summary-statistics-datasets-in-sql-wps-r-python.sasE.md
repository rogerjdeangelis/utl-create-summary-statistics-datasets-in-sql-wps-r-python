# utl-create-summary-statistics-datasets-in-sql-wps-r-python
Create summary statistics datasets in sql wps r python
    %let pgm=utl-create-summary-statistics-datasets-in-sql-wps-r-python;

    Create summary statistics datasets in sql wps r python

    Was unable to easily get an output dataframe from many of the posted  R native solutions.

         SOLUTIONS

            1. wps sql
            2. wps r sql
            3. wps python sql
            4. how to create the input

    github
    https://tinyurl.com/yjkh8z6j
    https://github.com/rogerjdeangelis/utl-create-summary-statistics-datasets-in-sql-wps-r-python

    stackoverflow
    https://tinyurl.com/4f8acuj9
    https://stackoverflow.com/questions/34594641/dplyr-summary-table-for-multiple-variables

    /*                   _
    (_)_ __  _ __  _   _| |_
    | | `_ \| `_ \| | | | __|
    | | | | | |_) | |_| | |_
    |_|_| |_| .__/ \__,_|\__|
            |_|
    */

    libname sd1 "d:/sd1";
    filename ft15f001 clear;
    filename ft15f001 temp lrecl=120 recfm=f;
    options validvarname=upcase;
    data sd1.have;
      infile ft15f001;
      input (CYL ENGSIZ MPGCITY MPGHWY) (4*2.)  @@;
      var='CYL    ';  val=cyl   ; output;
      var='ENGSIZ ';  val=engsiz; output;
      var='MGPCITY';  val=mpgcity;output;
      var='MGPHWY ';  val=mpghwy; output;
      drop engsiz mpgcity mpghwy cyl;
      if missing(cyl) then stop;
    parmcards4;
    063517230420243104242229063220280635182406351824063217240418223104182330063020280630172606301825063020270630182506302027
    063018250627182508421724084217240842142008421522041820280418202806322129063018250842152106301623084416220625202906252029
    062519270625192706302030063020300630202906251928063019280630203008441826084418260844182606321624063216230625202806302129
    062519260642152106341926063120300638202906382030063818280638202906382029063818280853141808461621063618250846182608461826
    084618260846172508601317085314180853141806421621062519220416283404162834042226370422263704222637063421320422243406352230
    063421320638203006381828063523320638182806431417063419260857182508571825085314180428182306431521086013170853161906352230
    042422290424222904242230062721280635182706272129063519270424212704242230063518270627212806331926063818250632172506351723
    084715210420293604202936062721290424212804242128063518270424202606381825108312200637162206371622063716211068101308461519
    064015200630182304202633042027360420263304202633042021280630202706301926084617250846172508461725063917230638202908461725
    083917240846151908541418042324290420263306301926064215190848161908601317064316200428182508481720086013180643151904144651
    032060660635172204242125042421240417323804173644041732380424263404242634041732370420263006302130063021300635182506351825
    042220250860101206272026041629330416293304162933042026340420263404202634062719270627192706351726063517260627192606351826
    063518260635182606351926084517230845172306351622084515190642152006321721062518260630182506301826084218280842172408421828
    084218280842172408421826084218260842162308421623064016210424202406401619063516190424233004162633041625320418243204182432
    041824320627202706351725063516220416263308441216084612160625182108471519084713170633182406332029063018250630182406301825
    084318230843182508431823063018240854131808461318063020260630202608391724083917240846172508461725084617250416283704162534
    04202225042026340423253104232432063018250418232804182328.131825.13182404232429064015190850131408501417041822300632192606
    262025062619250632192606322026063219270632162108501624125513190632202608501722063219270850162008431826085016240850162308
    551421125513190423212906321722062619250632192708501624064016210630202708461725084617250630192608461725084617230642162306
    301926063817210638151904242127042025310420253104242330042025310635182506381826063021280630212804201826042425310856131906
    351621063317200418283504182835042521260425232806352126063520280635202806351926063518250635202606352026063317200856141806
    352025042224320634202906341926063419260422243306342029063820300422243306382030084617200634192606341824085716200418293608
    451418063618260636172406361826063617240627202906321826042020280420202804232129042321290420212904202130042319290422212604
    222635042226350422263504222635042226350630202804222434041532380415313504252228042521280425212804252027063019260630192604
    202027042518240425212804252128042521280627182206251922042325310423253104202431042022300625202704232429041559510847141706
    401821063318240847131704242227041832400418324004183240041535430415333904153543042424330630212904242433063320290630212906
    302129063320290630212906331927063319270418243304182632042422270634161806341417041829360632152004202431041824310419384604
    182431062821300420243004182231062819260840182508421622126012190420243004182231084018250629152004192229052520270523202805
    25182506292028052520270524212805232026062919260419222905252027
    ;;;;
    run;quit;

    /**************************************************************************************************************************/
    /*                                                                                                                        */
    /*  SD1.HAVE total obs=1,716                                                                                              */
    /*                                                                                                                        */
    /*  Obs    VAR        VAL                                                                                                 */
    /*                                                                                                                        */
    /*    1    CYL          6                                                                                                 */
    /*    2    ENGSIZ      35                                                                                                 */
    /*    3    MGPCITY     17                                                                                                 */
    /*    4    MGPHWY      23                                                                                                 */
    /*    5    CYL          4                                                                                                 */
    /*    6    ENGSIZ      20                                                                                                 */
    /*    7    MGPCITY     24                                                                                                 */
    /*    8    MGPHWY      31                                                                                                 */
    /*    9    CYL          4                                                                                                 */
    /*   10    ENGSIZ      24                                                                                                 */
    /*   ....                                                                                                                 */
    /*                                                                                                                        */
    /**************************************************************************************************************************/

    /*                                  _
    / | __      ___ __  ___   ___  __ _| |
    | | \ \ /\ / / `_ \/ __| / __|/ _` | |
    | |  \ V  V /| |_) \__ \ \__ \ (_| | |
    |_|   \_/\_/ | .__/|___/ |___/\__, |_|
                 |_|                 |_|
    */

    proc datasets lib=sd1 mt=view mt=data nolist nodetails;delete want; run;quit;

    %utl_submit_wps64x('
    libname sd1 "d:/sd1";
    options validvarname=any;
    proc sql;
      create
        table sd1.want as
      select
        var
       ,count(val)    as  n
       ,min(val)      as  min
       ,avg(val)      as  mean
       ,median(val)   as  median
       ,max(val)      as  max
       ,std(val)   as  stddev
      from
        sd1.have
      group
        by var
    ;quit;
    proc print;
    run;quit;
    ');

    /**************************************************************************************************************************/
    /*                                                                                                                        */
    /*  The WPS System                                                                                                        */
    /*                                                                                                                        */
    /*  Obs      VAR       n     min      mean      median    max    stddev                                                   */
    /*                                                                                                                        */
    /*   1     CYL        428     0.1    16.0820       8       60    13.6895                                                  */
    /*   2     ENGSIZ     428    12.0    28.1051      24       83    11.1995                                                  */
    /*   3     MGPCITY    428    10.0    23.0140      21       82     7.1616                                                  */
    /*   4     MGPHWY     427     4.0    17.6370      21       66    11.3130                                                  */
    /*                                                                                                                        */
    /**************************************************************************************************************************/

    /*___                                          _
    |___ \  __      ___ __  ___   _ __   ___  __ _| |
      __) | \ \ /\ / / `_ \/ __| | `__| / __|/ _` | |
     / __/   \ V  V /| |_) \__ \ | |    \__ \ (_| | |
    |_____|   \_/\_/ | .__/|___/ |_|    |___/\__, |_|
                     |_|                        |_|
    */
    proc datasets lib=sd1 nolist nodetails;delete want; run;quit;

    %utl_submit_wps64x('
    libname sd1 "d:/sd1";
    proc r;
    export data=sd1.have r=have;
    submit;
    library(sqldf);
    want <- sqldf("
      select
        var
       ,count(val)    as  n
       ,min(val)      as  min
       ,avg(val)      as  mean
       ,median(val)   as  median
       ,max(val)      as  max
       ,stdev(val)    as  stddev
      from
        have
      group
        by var
    ");
    want;
    endsubmit;
    import data=sd1.want r=want;
    run;quit;
    ');

    proc print data=sd1.want;
    run;quit;

    /**************************************************************************************************************************/
    /*                                                                                                                        */
    /*  The WPS R System                                                                                                      */
    /*                                                                                                                        */
    /*        VAR   n  min     mean median max    stddev                                                                      */
    /*  1     CYL 428  0.1 16.08201      8  60 13.689509                                                                      */
    /*  2  ENGSIZ 428 12.0 28.10514     24  83 11.199518                                                                      */
    /*  3 MGPCITY 428 10.0 23.01402     21  82  7.161554                                                                      */
    /*  4  MGPHWY 427  4.0 17.63700     21  66 11.312955                                                                      */
    /*                                                                                                                        */
    /* SD1.WANT total obs=4                                                                                                   */
    /*                                                                                                                        */
    /* Obs    VAR         N      MIN      MEAN     MEDIAN    MAX     STDDEV                                                   */
    /*                                                                                                                        */
    /*  1     CYL        428     0.1    16.0820       8       60    13.6895                                                   */
    /*  2     ENGSIZ     428    12.0    28.1051      24       83    11.1995                                                   */
    /*  3     MGPCITY    428    10.0    23.0140      21       82     7.1616                                                   */
    /*  4     MGPHWY     427     4.0    17.6370      21       66    11.3130                                                   */
    /*                                                                                                                        */
    /**************************************************************************************************************************/


    /*____                                    _   _                             _
    |___ /  __      ___ __  ___   _ __  _   _| |_| |__   ___  _ __    ___  __ _| |
      |_ \  \ \ /\ / / `_ \/ __| | `_ \| | | | __| `_ \ / _ \| `_ \  / __|/ _` | |
     ___) |  \ V  V /| |_) \__ \ | |_) | |_| | |_| | | | (_) | | | | \__ \ (_| | |
    |____/    \_/\_/ | .__/|___/ | .__/ \__, |\__|_| |_|\___/|_| |_| |___/\__, |_|
                     |_|         |_|    |___/                                |_|
    */

    proc datasets nolist mt=data mt=view nodetails;delete want; run;quit;

    %utl_submit_wps64x("
    options validvarname=any lrecl=32756;
    libname sd1 'd:/sd1';
    proc python;
    export data=sd1.have python=have;
    submit;
    print(have);
    import pyreadstat;
    from os import path;
    import pandas as pd;
    import numpy as np;
    from pandasql import sqldf;
    mysql = lambda q: sqldf(q, globals());
    from pandasql import PandaSQL;
    pdsql = PandaSQL(persist=True);
    sqlite3conn = next(pdsql.conn.gen).connection.connection;
    sqlite3conn.enable_load_extension(True);
    sqlite3conn.load_extension('c:/temp/libsqlitefunctions.dll');
    mysql = lambda q: sqldf(q, globals());
    want = pdsql('''
      select
        var
       ,count(val)    as  n
       ,min(val)      as  min
       ,avg(val)      as  mean
       ,median(val)   as  median
       ,max(val)      as  max
       ,stdev(val)    as  stddev
      from
        have
      group
        by var
    ''');
    print(want);
    pyreadstat.write_xport(want,'d:\\xpt\\want.xpt',table_name='want',file_format_version=5);
    endsubmit;
    ");

    libname xpt xport "d:/xpt/want.xpt";
    proc contents data=xpt._all_;
    run;quit;

    proc print data=xpt.want;
    run;quit;


    /**************************************************************************************************************************/
    /*                                                                                                                        */
    /* The WPS Python System                                                                                                  */
    /*                                                                                                                        */
    /*        VAR    n   min       mean  median   max     stddev                                                              */
    /* 0  CYL      428   0.1  16.082009     8.0  60.0  13.689509                                                              */
    /* 1  ENGSIZ   428  12.0  28.105140    24.0  83.0  11.199518                                                              */
    /* 2  MGPCITY  428  10.0  23.014019    21.0  82.0   7.161554                                                              */
    /* 3  MGPHWY   427   4.0  17.637002    21.0  66.0  11.312955                                                              */
    /*                                                                                                                        */
    /*                                                                                                                        */
    /* SD1.WANT total obs=4                                                                                                   */
    /*                                                                                                                        */
    /*  VAR         N      MIN      MEAN     MEDIAN    MAX     STDDEV                                                         */
    /*                                                                                                                        */
    /*  CYL        428     0.1    16.0820       8       60    13.6895                                                         */
    /*  ENGSIZ     428    12.0    28.1051      24       83    11.1995                                                         */
    /*  MGPCITY    428    10.0    23.0140      21       82     7.1616                                                         */
    /*  MGPHWY     427     4.0    17.6370      21       66    11.3130                                                         */
    /*                                                                                                                        */
    /**************************************************************************************************************************/

    /*  _                     _        _                   _
    | || |    _ __ ___   __ _| | ___  (_)_ __  _ __  _   _| |_
    | || |_  | `_ ` _ \ / _` | |/ _ \ | | `_ \| `_ \| | | | __|
    |__   _| | | | | | | (_| | |  __/ | | | | | |_) | |_| | |_
       |_|   |_| |_| |_|\__,_|_|\___| |_|_| |_| .__/ \__,_|\__|
                                              |_|
    */

    options ls=120;
    libname sd1 "d:/sd1";
    data have;
      format  CYL z2.  ENGSIZ  MPGCITY  MPGHWY 2.;
      set sashelp.cars(
              keep=enginesize cylinders mpg_city mpg_highway
              rename=(enginesize=engSiz cylinders=cyl mpg_city=mpgcity mpg_highway=mpghwy)) ;
              engsiz=10*engsiz;
              put CYL +(-1) ENGSIZ +(-1) MPGCITY +(-1) MPGHWY +(-1) @@;
    run;quit;

    /*              _
      ___ _ __   __| |
     / _ \ `_ \ / _` |
    |  __/ | | | (_| |
     \___|_| |_|\__,_|

    */

